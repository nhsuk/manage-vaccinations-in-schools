<% return if discrepancies.blank? %>

<details class="nhsuk-details nhsuk-expander">
      <summary class="nhsuk-details__summary" data-module="app-sticky">
        <span class="nhsuk-details__summary-text">
          <%= pluralize(discrepancies.count, "NHS number") %> updated
        </span>
      </summary>
      <div class="nhsuk-details__text">

  <%= govuk_table(html_attributes: { class: "nhsuk-table-responsive" }) do |table| %>
    <% table.with_head do |head| %>
      <% head.with_row do |row| %>
        <% row.with_cell(text: "Child record") %>
        <% row.with_cell(text: "NHS number (upload)") %>
        <% row.with_cell(text: "NHS number (Spine)") %>
      <% end %>
    <% end %>

    <% table.with_body do |body| %>
      <% discrepancies.each do |changeset| %>
        <% patient = changeset.patient %>

        <% body.with_row do |row| %>
          <% row.with_cell do %>
            <span class="nhsuk-table-responsive__heading">Child record</span>
            <span>
              <% if can_link_to?(patient) %>
                <%= link_to patient.full_name, patient_path(patient) %>
              <% else %>
                <%= patient.full_name %>
              <% end %>
            </span>
          <% end %>

          <% row.with_cell do %>
            <span class="nhsuk-table-responsive__heading">Uploaded NHS number</span>
            <%= format_nhs_number(changeset.uploaded_nhs_number) %>
          <% end %>

          <% row.with_cell do %>
            <span class="nhsuk-table-responsive__heading">PDS NHS number</span>
            <%= format_nhs_number(changeset.pds_nhs_number) %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
</div>
</details>
