<%= form_with model: form, url:, method:, builder: do |f| %>
  <% content_for(:before_content) { f.govuk_error_summary } %>

  <%= f.govuk_radio_buttons_fieldset :status_option, **fieldset_options do %>
    <% form.safe_to_vaccinate_options.each do |option| %>
      <%= f.govuk_radio_button :status_option, option do %>
        <% if form.show_add_patient_specific_direction?(option) %>
          <%= f.govuk_radio_buttons_fieldset :add_patient_specific_direction,
                                             legend: { text: "Do you want to add a PSD?", size: "s" } do %>
            <%= f.govuk_radio_button :add_patient_specific_direction, "true", label: { text: "Yes" } %>
            <%= f.govuk_radio_button :add_patient_specific_direction, "false", label: { text: "No" } %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>

    <%= f.govuk_radio_divider %>

    <% form.other_options.each do |option| %>
      <% if option == "delay_vaccination" %>
        <%= f.govuk_radio_button :status_option, option, link_errors: true do %>
            <%= f.govuk_date_field :delay_vaccination_until,
                                   legend: { text: "What is the earliest date #{form.patient.given_name} can be vaccinated?", size: "s" },
                                   hint: { text: "For example, #{hint_date.strftime("%d %m %Y")}" },
                                   link_errors: true %>
        <% end %>
      <% else %>
      <%= f.govuk_radio_button :status_option, option %>
      <% end %>
    <% end %>
  <% end %>

  <%= f.govuk_text_area :notes, label: { text: "Triage notes (optional)" }, rows: 5 %>

  <%= f.govuk_submit continue ? "Continue" : "Save triage" %>
<% end %>
