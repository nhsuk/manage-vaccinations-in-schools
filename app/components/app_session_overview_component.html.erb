<div class="nhsuk-grid-column-full">
  <% programmes.each do |programme| %>
    <section>
      <h3 class="nhsuk-heading-m nhsuk-u-margin-bottom-2">
        <%= programme.name %>
      </h3>

      <p class="nhsuk-caption-m nhsuk-u-margin-bottom-4">
        <%= t(".eligibility_message", count: eligible_children_count(programme)) %>
      </p>

      <% cards = cards_for_programme(programme) %>

      <ul class="nhsuk-grid-row nhsuk-card-group">
        <% cards.each do |card_data| %>
          <li class="nhsuk-grid-column-<%= grid_column_class(cards.length) %> nhsuk-card-group__item">
            <%= render AppCardComponent.new(compact: true,
                                            colour: card_data[:colour],
                                            link_to: card_data[:link_to]) do |card| %>
              <% card.with_heading(size: "xs") { card_data[:heading] } %>
              <% card.with_data { card_data[:count].to_s } %>
            <% end %>
          </li>
        <% end %>
      </ul>
    </section>
  <% end %>

  <section>
    <%= render AppCardComponent.new do |card| %>
      <% if session.today? %>
        <%= govuk_inset_text classes: "nhsuk-u-margin-top-4 nhsuk-u-margin-bottom-4" do %>
          <%= link_to t(".still_to_vaccinate_message", count: still_to_vaccinate_count),
                      session_patients_path(session, still_to_vaccinate: 1) %>
        <% end %>
      <% end %>

      <% card.with_heading(level: 3) { heading } %>

      <% if session.started? %>
        <%= render AppSessionDatesTableComponent.new(session) %>
      <% else %>
        <% if dates.present? %>
          <%= tag.ul(class: "nhsuk-list") do %>
            <% dates.each do |date| %>
              <%= tag.li(date.to_fs(:long_day_of_week)) %>
            <% end %>
          <% end %>
          <p class="nhsuk-body">Consent period <%= session_consent_period(@session).downcase_first %></p>
        <% else %>
          <p class="nhsuk-hint"><%= no_sessions_message %></p>
        <% end %>
      <% end %>

      <% unless Flipper.enabled?(:schools_and_sessions) %>
        <%= render AppSessionButtonsComponent.new(session) %>
      <% end %>
    <% end %>
  </section>

  <section>
    <%= render AppSessionActionsComponent.new(session) %>
  </section>

  <section>
    <%= render AppSessionDetailsComponent.new(session) %>
  </section>

  <section>
    <% if Flipper.enabled?(:schools_and_sessions) %>
      <%= render AppSessionButtonsComponent.new(session) %>
    <% end %>
  </section>
</div>
