<%= helpers.govuk_table(
     html_attributes: {
       class: "nhsuk-table-responsive",
     },
   ) do |table| %>
  <% table.with_head do |head| %>
    <% head.with_row do |row| %>
      <% row.with_cell(text: "CSV file row") %>
      <% row.with_cell(text: "Name and NHS number") %>
      <% row.with_cell(text: "School move") %>
    <% end %>
  <% end %>

  <% table.with_body do |body| %>
    <% @changesets.each do |changeset| %>
      <% patient = changeset.patient %>
      <% body.with_row do |row| %>
        <% row.with_cell do %>
          <%= changeset.row_number ? changeset.csv_row_number.to_s : "" %>
        <% end %>

        <% row.with_cell do %>
          <span class="nhsuk-table-responsive__heading">Name and NHS number</span>
          <span><%= patient.full_name %></span>
          <br>
          <span class="nhsuk-u-secondary-text-colour nhsuk-u-font-size-16">
            <%= helpers.patient_nhs_number(patient) %>
          </span>
        <% end %>

        <% row.with_cell do %>
          <span class="nhsuk-table-responsive__heading">Move</span>
          <span>
            <%= helpers.patient_school(patient) %>
            <br>
            <span class="nhsuk-u-secondary-text-colour nhsuk-u-font-size-16">to</span>
            <%= destination_school_name(changeset) %>
          </span>
          <% if school_move_across_teams?(changeset) %>
            <% source_team = changeset.patient.teams_via_patient_locations.first %>
            <div class="nhsuk-u-margin-top-1">
              <%= render(
                    AppStatusComponent.new(
                      text: "This child is moving in from #{source_team.name}'s area",
                      small: true,
                      classes: "nhsuk-u-margin-top-1 nhsuk-u-margin-bottom-0",
                    )
                  ) %>
            </div>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>