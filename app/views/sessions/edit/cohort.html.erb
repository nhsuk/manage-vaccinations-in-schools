<% content_for :before_main do %>
  <%= render AppBacklinkComponent.new(
        href: previous_wizard_path,
        name: "#{@previous_step} page of session creation",
      ) %>
<% end %>

<%= form_for @session, url: wizard_path, method: :put do |f| %>
  <%= f.govuk_error_summary %>
  <%= h1 "Choose cohort for this session" %>

  <%= govuk_table(classes: "app-table--select-cohort",
                  html_attributes: { data: { module: "check-all" } }) do |table|
        table.with_head do |head|
          head.with_row do |row|
            row.with_cell do
              tag.div class: "nhsuk-checkboxes",
                      hidden: true,
                      data: { "check-all-target": "checkAll" } do
                f.govuk_check_box(
                  "all_patients",
                  1,
                  checked: @session.patients.empty?,
                  label: { text: "Select all patients", hidden: true },
                )
              end
            end
            row.with_cell(text: "Name")
            row.with_cell(text: "Date of birth")
            row.with_cell(text: "Year group")
          end
        end
      
        table.with_body do |body|
          @patients.each do |patient|
            body.with_row do |row|
              row.with_cell do
                tag.div class: "nhsuk-checkboxes" do
                  f.govuk_check_box(
                    "patient_ids",
                    patient.id,
                    checked: @session.patients.empty? || patient.in?(@session.patients),
                    label: { text: "Select #{patient.full_name}", hidden: true },
                    data: { "check-all-target": "item" },
                  )
                end
              end
              row.with_cell(text: patient.full_name)
              row.with_cell(text: patient.date_of_birth.to_fs(:long))
              row.with_cell(
                text: t("activerecord.attributes.patient.year_group.#{patient.year_group}"),
              )
            end
          end
        end
      end %>

  <%= f.govuk_submit "Continue" %>
<% end %>
