<% content_for :before_main do %>
  <%= render AppBreadcrumbComponent.new(items: [
                                          { text: t("dashboard.index.title"), href: dashboard_path },
                                          { text: t("sessions.index.title"), href: sessions_path },
                                          { text: @session.location.name, href: session_path(@session) },
                                        ]) %>
<% end %>

<%= render "sessions/header" %>

<div class="nhsuk-grid-row">
  <div class="app-grid-column-filters">
    <%= render AppPatientSearchFormComponent.new(
          @form,
          url: session_patients_path(@session),
          current_team:,
          programmes: @session.programmes,
          programme_statuses: @programme_statuses,
          vaccination_statuses: @statuses,
          year_groups: @session.year_groups,
          show_eligible_children: true,
        ) %>
  </div>

  <div class="app-grid-column-results">
    <%= render AppSessionNeedsReviewComponent.new(@session) %>

    <%= render AppSearchResultsComponent.new(@pagy, label: "children") do %>
      <% @patients.each do |patient| %>
        <%= render AppPatientSessionSearchResultCardComponent.new(
              patient:,
              session: @session,
              context: :patients,
              programmes: @form.programmes,
            ) %>
      <% end %>
    <% end %>
  </div>
</div>
