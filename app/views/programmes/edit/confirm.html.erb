<% content_for :before_main do %>
  <%= render AppBacklinkComponent.new(
        href: @programme.active ? programme_path(@programme) : previous_wizard_path,
        name: @programme.active ? @programme.name : "#{@previous_step} page of programme creation",
      ) %>
<% end %>

<%= form_with model: @programme, url: wizard_path, method: :put do |f| %>
  <%= f.govuk_error_summary %>

  <%= h1 @programme.active ? "Edit programme" : "Check and confirm" %>

  <%= render AppCardComponent.new do |card| %>
    <% card.with_heading { @programme.active ? "Programme details" : "New programme details" } %>

    <%= govuk_summary_list do |summary_list| %>
      <%= summary_list.with_row do |row| %>
        <%= row.with_key { "Name" } %>
        <%= row.with_value { @programme.name } %>
        <%= row.with_action(text: "Change", href: programme_edit_path(@programme, :details), visually_hidden_text: "name") %>
      <% end %>

      <%= summary_list.with_row do |row| %>
        <%= row.with_key { "Programme type" } %>
        <%= row.with_value { @programme.human_enum_name(:type) } %>
        <%= row.with_action(text: "Change", href: programme_edit_path(@programme, :details), visually_hidden_text: "programme type") %>
      <% end %>

      <%= summary_list.with_row do |row| %>
        <%= row.with_key { "Academic year" } %>
        <%= row.with_value { programme_academic_year(@programme) } %>
        <%= row.with_action(text: "Change", href: programme_edit_path(@programme, :details), visually_hidden_text: "academic year") %>
      <% end %>

      <%= summary_list.with_row do |row| %>
        <%= row.with_key { "Start date" } %>
        <%= row.with_value { @programme.start_date.to_fs(:long) } %>
        <%= row.with_action(text: "Change", href: programme_edit_path(@programme, :dates), visually_hidden_text: "start date") %>
      <% end %>

      <%= summary_list.with_row do |row| %>
        <%= row.with_key { "End date" } %>
        <%= row.with_value { @programme.end_date.to_fs(:long) } %>
        <%= row.with_action(text: "Change", href: programme_edit_path(@programme, :dates), visually_hidden_text: "end date") %>
      <% end %>

      <% if @programme.active %>
        <%= summary_list.with_row do |row| %>
          <%= row.with_key { "Vaccines" } %>
          <%= row.with_value { @programme.vaccines.map(&:brand).join("<br>").html_safe } %>
          <%= row.with_action(text: "Change", href: programme_edit_path(@programme, :vaccines), visually_hidden_text: "vaccines") %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <%= f.govuk_submit "Save changes" %>
<% end %>
