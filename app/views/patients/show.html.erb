<% content_for :before_main do %>
  <%= render AppBreadcrumbComponent.new(items: [
                                          { text: t("dashboard.index.title"), href: dashboard_path },
                                          { text: t("patients.index.title"), href: patients_path },
                                        ]) %>
<% end %>

<%= render "patients/header" %>

<%= render AppSecondaryNavigationComponent.new do |nav|
      nav.with_item(href: patient_path(@patient), text: "Child record", selected: true)
      nav.with_item(href: log_patient_path(@patient), text: "Activity log")
    end %>

<% vaccinations_card = capture do %>
  <%= render AppCardComponent.new(section: true) do |card| %>
    <% card.with_heading { "Vaccinations" } %>
    <%= render AppPatientVaccinationTableComponent.new(
          @patient, academic_year: AcademicYear.current, show_caption: false,
        ) %>
  <% end %>
<% end %>

<% if current_team.has_upload_only_access? %>
  <%= vaccinations_card %>
<% end %>

<%= render AppPatientCardComponent.new(
      @patient,
      current_team:,
      show_parents: !current_team.has_upload_only_access?,
    ) do %>
  <% if @patient.not_archived?(team: current_team) %>
    <div class="nhsuk-button-group">
      <%= govuk_button_link_to "Edit child record", edit_patient_path(@patient), secondary: true %>
      <%= govuk_button_link_to "Archive child record", new_patient_archive_path(@patient), class: "app-button--secondary-warning" %>
    </div>
  <% elsif current_team.has_upload_only_access? %>
    <div class="nhsuk-button-group">
      <%= govuk_button_link_to "Edit child record", edit_patient_path(@patient), secondary: true %>
    </div>
  <% end %>
<% end %>

<% unless current_team.has_upload_only_access? %>

  <%= render AppCardComponent.new(section: true) do |card| %>
    <%= render AppPatientProgrammesTableComponent.new(
          @patient,
          programmes: current_user.programmes,
          current_team:,
        ) %>
  <% end %>

  <%= render AppCardComponent.new(section: true) do |card| %>
    <% card.with_heading { "Sessions" } %>
    <%= render AppPatientSessionTableComponent.new(@patient, current_team:) %>

    <% unless @in_generic_clinic %>
      <%= govuk_button_to "Invite to community clinic", invite_to_clinic_patient_path(@patient), secondary: true %>
    <% end %>
  <% end %>

  <%= vaccinations_card %>
<% end %>
