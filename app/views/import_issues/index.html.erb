<% content_for :page_title, "#{@programme.name} â€“ Import issues" %>

<% content_for :before_main do %>
  <%= render AppBreadcrumbComponent.new(items: [
                                          { text: t("programmes.index.title"), href: programmes_path },
                                          { text: @programme.name, href: programme_path(@programme) },
                                        ]) %>
<% end %>

<%= render "programmes/name_and_academic_year" %>

<%= render AppSecondaryNavigationComponent.new do |nav|
      nav.with_item(
        text: "Overview",
        href: programme_path(@programme),
      )
      nav.with_item(
        text: t("programmes.patients.title"),
        href: patients_programme_path(@programme),
      )
      nav.with_item(
        text: "School sessions",
        href: sessions_programme_path(@programme),
      )
      nav.with_item(
        text: t("vaccination_records.index.title"),
        href: programme_vaccination_records_path(@programme),
      )
      nav.with_item(
        text: t("immunisation_imports.index.title"),
        href: programme_immunisation_imports_path(@programme),
      )
      nav.with_item(
        href: programme_import_issues_path(@programme),
        selected: true,
      ) do
        t("import_issues.index.title") + " (#{@programme.import_issues.count})"
      end
    end %>

<% if @import_issues.any? %>
  <div class="nhsuk-table__panel-with-heading-tab">
    <h3 class="nhsuk-table__heading-tab">
      <%= pluralize(@import_issues.count, "imported record") %>
      <%= @import_issues.count == 1 ? "needs" : "need" %> review
    </h3>
    <%= govuk_table(html_attributes: {
                      class: "nhsuk-table-responsive",
                    }) do |table| %>
      <% table.with_head do |head| %>
        <% head.with_row do |row| %>
          <% row.with_cell(text: "Child record") %>
          <% row.with_cell(text: "Issue to review") %>
          <% row.with_cell(text: "Actions") %>
        <% end %>
      <% end %>

      <% table.with_body do |body| %>
        <% @import_issues.each do |import_issue| %>
          <% body.with_row do |row| %>
            <% row.with_cell do %>
              <span class="nhsuk-table-responsive__heading">Child record</span>
              <%= import_issue.patient.full_name %>
            <% end %>

            <% row.with_cell do %>
              <span class="nhsuk-table-responsive__heading">
                Issue to review
              </span>
              A field in a duplicate record does not match a previously uploaded
              record
            <% end %>

            <% row.with_cell do %>
              <span class="nhsuk-table-responsive__heading">Actions</span>
              <%= govuk_link_to programme_import_issue_path(
                    @programme,
                    import_issue
                  ) do %>
                Review
                <span class="nhsuk-u-visually-hidden">
                  <%= import_issue.patient.full_name %>
                </span>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
<% else %>
  <p>No issues to review.</p>
<% end %>
