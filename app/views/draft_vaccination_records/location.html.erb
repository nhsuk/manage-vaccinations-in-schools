<% content_for :before_main do %>
  <%= govuk_back_link(href: @back_link_path) %>
<% end %>

<% title = "Where was the #{@programme.name_in_sentence} vaccination offered?" %>
<% content_for :page_title, title %>

<%= form_with model: @draft_vaccination_record, url: wizard_path, method: :put do |f| %>
  <%= f.govuk_error_summary %>

<% if @draft_vaccination_record.bulk_upload_user_and_record? %>
  <%= f.govuk_select :location_id,
                     label: { text: "Location", size: "l", tag: "h1" },
                     caption: { text: @patient.full_name },
                     data: { module: "app-autocomplete", disablehints: true, minlength: 3 } do %>

      <% @locations.find_each do |location| %>
        <%= tag.option location_display_name(location, show_urn: true),
                       value: location.id,
                       selected: location.id == @draft_vaccination_record.location&.id %>
      <% end %>
      <%= tag.option "Unknown", value: "unknown", selected: @draft_vaccination_record.location.nil? %>
  <% end %>
<% else %>
  <%= f.govuk_radio_buttons_fieldset :location_id,
                                     caption: { text: @patient.full_name, size: "l" },
                                     legend: { size: "l", tag: "h1",
                                               text: title } do %>

    <% @locations.each do |location| %>
      <%= f.govuk_radio_button :location_id, location.id,
                               label: { text: location.name },
                               hint: { text: format_address_single_line(location) } %>
    <% end %>
  <% end %>
<% end %>

  <%= f.govuk_submit "Continue" %>
<% end %>
