<%= content_for :page_title, "#{@programme.name} â€“ #{t("immunisation_imports.index.title")}" %>

<% content_for :before_main do %>
  <%= render AppBreadcrumbComponent.new(items: [
                                          { text: t("programmes.index.title"), href: programmes_path },
                                          { text: @programme.name, href: programme_path(@programme) },
                                        ]) %>
<% end %>

<%= render "programmes/name_and_academic_year" %>

<%= render AppProgrammeNavigationComponent.new(@programme, active: :immunisation_imports) %>

<%= govuk_button_link_to "Import vaccination records", new_programme_immunisation_import_path, class: "app-button--secondary" %>

<% if @immunisation_imports.any? %>
  <div class="nhsuk-table__panel-with-heading-tab">
    <h3 class="nhsuk-table__heading-tab">Uploads</h3>

    <%= govuk_table(html_attributes: { class: "nhsuk-table-responsive" }) do |table| %>
      <% table.with_head do |head| %>
        <% head.with_row do |row| %>
          <% row.with_cell(text: "Upload date") %>
          <% row.with_cell(text: "Uploaded by") %>
          <% row.with_cell(text: "Records", numeric: true) %>
        <% end %>
      <% end %>

      <% table.with_body do |body| %>
        <% @immunisation_imports.each do |immunisation_import| %>
          <% body.with_row do |row| %>
            <% row.with_cell do %>
              <span class="nhsuk-table-responsive__heading">Upload date</span>
              <%= govuk_link_to immunisation_import.created_at.to_fs(:long), programme_immunisation_import_path(@programme, immunisation_import) %>
            <% end %>
            <% row.with_cell do %>
              <span class="nhsuk-table-responsive__heading">Uploaded by</span>
              <%= immunisation_import.uploaded_by.full_name %>
            <% end %>
            <% row.with_cell(numeric: true) do %>
              <span class="nhsuk-table-responsive__heading">Records</span>
              <%= immunisation_import.vaccination_records.count %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
<% end %>

<% content_for :after_main do %>
  <%= render(AppDevToolsComponent.new) do %>
    <%= govuk_button_to "Download DPS export", export_dps_programme_vaccination_records_path(@programme) %>
    <%= govuk_button_to "Reset DPS export for programme", reset_dps_export_programme_vaccination_records_path(@programme) %>
  <% end %>
<% end %>
