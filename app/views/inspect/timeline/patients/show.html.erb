<%= h1 page_title: @patient.initials do %>
  <%= "Inspect Patient #{@patient.id}" %>
<% end %>

<p>
  <code><%= "Patient.find(#{@patient.id})" %></code>
</p>

<%= link_to "View graph", inspect_path(:patient, @patient.id), class: "nhsuk-button nhsuk-button--secondary" %>

<div class="nhsuk-grid-row">
  <div class="app-grid-column-filters">
    <%= render AppTimelineFilterComponent.new(
          url: inspect_timeline_patient_path,
          patient: @patient,
          teams: @patient.teams,
          event_options: TimelineRecords::DEFAULT_DETAILS_CONFIG,
          timeline_fields: @show_pii ? TimelineRecords::AVAILABLE_DETAILS_CONFIG_WITH_PII : TimelineRecords::AVAILABLE_DETAILS_CONFIG,
          class_imports: @patient_events[:class_imports],
          cohort_imports: @patient_events[:cohort_imports],
          sessions: @patient_events[:sessions],
          additional_class_imports: @additional_events[:class_imports],
          reset_url: inspect_timeline_patient_path(
            event_names: TimelineRecords::DEFAULT_DETAILS_CONFIG.keys,
            detail_config: TimelineRecords::DEFAULT_DETAILS_CONFIG,
            compare_option: nil,
            show_pii: false,
          ),
          show_pii: @show_pii,
          pii_access_allowed: @user_is_allowed_to_access_pii,
          event_names: @event_names,
        ) %>
  </div>

  <div class="app-grid-column-results">
    <div class="nhsuk-grid-row">
      <% if @no_events_message %>
        <div class="nhsuk-grid-column-full">
          <%= render AppWarningCalloutComponent.new(
                heading: "No events found",
                description: "Patient-#{@patient.id} doesn't have the following events recorded: " +
                             "#{@event_names.map(&:humanize).join(", ")}".html_safe,
              ) %>
        </div>
      <% else %>
        <% if @compare_patient_timeline || @invalid_patient_id || @no_events_compare_message %>
          <div class="nhsuk-grid-column-one-half">
            <h2 class="nhsuk-heading-m">Patient <%= @patient.id %></h2>
            <%= render AppTimelineComponent.new(@patient_timeline) %>
          </div>

          <% if @invalid_patient_id %>
            <div class="nhsuk-grid-column-one-half">
              <%= render AppWarningCalloutComponent.new(
                    heading: "Invalid patient ID",
                    description: "Patient-#{params[:manual_patient_id]} doesn't exist",
                  ) %>
            </div>
          <% elsif @no_events_compare_message %>
            <div class="nhsuk-grid-column-one-half">
              <%= render AppWarningCalloutComponent.new(
                    heading: "No events found for comparison patient",
                    description: "Patient-#{@compare_patient.id} doesn't have the following events recorded: " +
                                 "#{@event_names.map(&:humanize).join(", ")}".html_safe,
                  ) %>
            </div>
          <% elsif @compare_patient_timeline %>
            <div class="nhsuk-grid-column-one-half">
              <h2 class="nhsuk-heading-m">Patient <%= @compare_patient.id %></h2>
              <%= render AppTimelineComponent.new(@compare_patient_timeline) %>
            </div>
          <% end %>
        <% else %>
          <div class="nhsuk-grid-column-full">
            <%= render AppTimelineComponent.new(@patient_timeline) %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>